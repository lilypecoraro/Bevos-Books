@model Team24_BevosBooks.Models.Book

@{
    ViewData["Title"] = "Book Details";
    var reviews = Model.Reviews ?? new List<Review>();
}

<style>
    /* ============================================================
       BOOK DETAILS PAGE — RIGHT-SIDE CARD (white background)
    =============================================================== */
    .book-details-card {
        background: rgba(255,255,255,0.95) !important;
        color: #000 !important;
        border-radius: 14px;
        padding: 1.5rem 1.75rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.35);
        border: 1px solid rgba(0,0,0,0.12);
        margin-bottom: 2rem;
    }

        .book-details-card * {
            color: #000 !important;
        }

    .book-details-price {
        font-weight: 700;
        font-size: 1.3rem;
        color: var(--bevo-brown) !important;
    }

    /* ============================================================
       LEFT SIDE: TITLES + VALUES
    =============================================================== */
    .book-details-left dt {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--bevo-gold) !important;
    }

    .book-details-left dd {
        margin-bottom: 1rem;
        font-size: 1.15rem;
    }

    /* ============================================================
       REVIEWS SECTION — styled like details card
    =============================================================== */
    .reviews-card {
        background: rgba(255,255,255,0.95) !important;
        border-radius: 14px;
        padding: 1.25rem 1.5rem;
        box-shadow: 0 6px 18px rgba(0,0,0,0.25);
        border: 1px solid rgba(0,0,0,0.12);
        margin-top: 1.5rem;
    }

        .reviews-card h4 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--bevo-gold);
            margin-bottom: 1rem;
        }

    .review-item {
        border-bottom: 1px solid rgba(0,0,0,0.1);
        padding: 0.75rem 0;
    }

        .review-item:last-child {
            border-bottom: none;
        }

    .review-rating {
        font-weight: 600;
        color: var(--bevo-brown);
    }

    .review-text {
        margin: 0.25rem 0;
    }

    .review-author {
        font-size: 0.9rem;
        color: #555;
    }
</style>

<h2 class="mt-3 mb-3">Book Details</h2>

<div class="row">
    <!-- LEFT SIDE -->
    <div class="col-md-8 book-details-left">
        <dl class="row">
            <dt class="col-sm-3">Title</dt>
            <dd class="col-sm-9">@Model.Title</dd>

            <dt class="col-sm-3">Authors</dt>
            <dd class="col-sm-9">@Model.Authors</dd>

            <dt class="col-sm-3">Genre</dt>
            <dd class="col-sm-9">@Model.Genre?.GenreName</dd>

            <dt class="col-sm-3">Book #</dt>
            <dd class="col-sm-9">@Model.BookNumber</dd>

            <dt class="col-sm-3">Price</dt>
            <dd class="col-sm-9">@Model.Price.ToString("c")</dd>

            <dt class="col-sm-3">Publish Date</dt>
            <dd class="col-sm-9">@Model.PublishDate.ToShortDateString()</dd>

            <dt class="col-sm-3">Description</dt>
            <dd class="col-sm-9">@Model.Description</dd>

            <dt class="col-sm-3">Inventory</dt>
            <dd class="col-sm-9">@Model.InventoryQuantity</dd>

            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">@Model.BookStatus</dd>
        </dl>

        <!-- REVIEWS SECTION -->
        <div class="reviews-card">
            <h4>Reviews</h4>
            @{
                var avgRating = reviews.Any()
                    ? Math.Round(reviews.Average(r => (double)r.Rating), 1)
                    : (double?)null;
            }
            <p><strong>Average Rating:</strong> @(avgRating.HasValue ? avgRating.Value.ToString("0.0") : "N/A")</p>

            @if (!reviews.Any())
            {
                <p class="text-muted">No approved reviews yet.</p>
            }
            else
            {
                @foreach (var r in reviews)
                {
                    <div class="review-item">
                        <span class="review-rating">@r.Rating ★</span>
                        <p class="review-text">@r.ReviewText</p>
                        <p class="review-author">— @r.Reviewer.FirstName @r.Reviewer.LastName</p>
                    </div>
                }
            }
        </div>
    </div>

    <!-- RIGHT SIDE: AVAILABILITY CARD -->
    <div class="col-md-4">
        <div class="book-details-card">
            <h5 class="book-details-title">@Model.Title</h5>
            <p class="mb-3">
                <strong>Price:</strong>
                <span class="book-details-price">@Model.Price.ToString("c")</span><br />
                <strong>Availability:</strong>
                @if (Model.BookStatus == "Discontinued")
                {
                    <span class="text-danger">Not Available (Discontinued)</span>
                }
                else if (Model.InventoryQuantity > 0)
                {
                    <span class="text-success">In Stock</span>
                }
                else
                {
                    <span class="text-warning">Out of Stock</span>
                }
            </p>

            <a asp-action="Index" class="btn btn-link w-100 mt-1">Back to List</a>
        </div>
    </div>
</div>
