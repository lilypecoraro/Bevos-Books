@model IEnumerable<Team24_BevosBooks.Models.AppUser>
@using Microsoft.AspNetCore.Identity
@using Team24_BevosBooks.Models
@inject UserManager<AppUser> UserManager

@{
    ViewData["Title"] = "Manage Employees";
}

<h2 class="mt-4 mb-3">Employees & Admins</h2>

<a asp-action="CreateEmployee" class="btn btn-primary mb-3">Create New Employee</a>

<table class="table table-striped">
    <thead class="table-dark">
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Roles</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var emp in Model)
        {
            bool isAdmin = emp.RoleNames.Contains("Admin");
            bool isEmployee = emp.RoleNames.Contains("Employee");
            bool isCurrentUser = emp.Id == UserManager.GetUserId(User);

            <tr>
                <td>@emp.FirstName @emp.LastName</td>
                <td>@emp.Email</td>

                <td>
                    @if (isAdmin)
                    {
                        <span>Admin</span>
                    }
                    else if (isEmployee)
                    {
                        <span>Employee</span>
                    }
                </td>

                <td>@emp.Status</td>

                <td class="text-nowrap">

                    <!-- EDIT BUTTON -->
                    <a asp-action="EditEmployee"
                       asp-route-id="@emp.Id"
                       class="btn btn-sm btn-warning me-2">
                        Edit
                    </a>

                    <!-- PROMOTE (Employee → Admin) -->
                    @if (isEmployee)
                    {
                        <a asp-action="Promote"
                           asp-route-id="@emp.Id"
                           class="btn btn-sm btn-info me-2"
                           onclick="return confirm('Promote this employee to ADMIN?');">
                            Promote to Admin
                        </a>
                    }

                    <!-- DEMOTE (Admin → Employee) -->
                    @if (isAdmin && !isCurrentUser)
                    {
                        <a asp-action="Demote"
                           asp-route-id="@emp.Id"
                           class="btn btn-sm btn-secondary me-2"
                           onclick="return confirm('Demote this ADMIN back to Employee?');">
                            Demote to Employee
                        </a>
                    }

                    <!-- NEW: FIRE / REHIRE BUTTON -->
                    @if (emp.Status != AppUser.UserStatus.Disabled)
                    {
                        <a asp-action="Disable"
                           asp-route-id="@emp.Id"
                           class="btn btn-sm btn-danger me-2"
                           onclick="return confirm('Fire this employee? They will be disabled and blocked from logging in.');">
                            Fire
                        </a>
                    }
                    else
                    {
                        <a asp-action="Enable"
                           asp-route-id="@emp.Id"
                           class="btn btn-sm btn-success me-2"
                           onclick="return confirm('Rehire this employee? They will regain access.');">
                            Rehire
                        </a>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
