@model Team24_BevosBooks.Models.Book

@{
    ViewData["Title"] = "Book Details (Procurement)";
}

<h2>@Model.Title</h2>

<div class="row">
    <div class="col-md-6">
        <dl class="row">
            <dt class="col-sm-4">Title</dt>
            <dd class="col-sm-8">@Model.Title</dd>

            <dt class="col-sm-4">Authors</dt>
            <dd class="col-sm-8">@Model.Authors</dd>

            <dt class="col-sm-4">Genre</dt>
            <dd class="col-sm-8">@Model.Genre?.GenreName</dd>

            <dt class="col-sm-4">Price</dt>
            <dd class="col-sm-8">@Model.Price.ToString("C")</dd>

            <dt class="col-sm-4">Inventory</dt>
            <dd class="col-sm-8">@Model.InventoryQuantity</dd>

            <dt class="col-sm-4">Reorder Point</dt>
            <dd class="col-sm-8">@Model.ReorderPoint</dd>

            <dt class="col-sm-4">Last Supplier Cost</dt>
            <dd class="col-sm-8">
                @{
                    var lastCost = ViewBag.LastCosts != null && ViewBag.LastCosts.ContainsKey(Model.BookID)
                        ? (decimal)ViewBag.LastCosts[Model.BookID]
                        : 0m;
                }
                @(lastCost > 0 ? lastCost.ToString("C") : "N/A")
            </dd>

            <dt class="col-sm-4">Average Profit Margin</dt>
            <dd class="col-sm-8">
                @{
                    var avgMargin = ViewBag.AvgMargins != null && ViewBag.AvgMargins.ContainsKey(Model.BookID)
                        ? (decimal)ViewBag.AvgMargins[Model.BookID]
                        : 0m;
                }
                @($"{avgMargin:P2}")
            </dd>
        </dl>
    </div>
</div>

<hr />

<h4>Approved Reviews</h4>
@if (Model.Reviews != null && Model.Reviews.Any())
{
    <table class="table table-striped">
        <thead class="table-dark">
            <tr>
                <th>Reviewer</th>
                <th>Rating</th>
                <th>Comment</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var review in Model.Reviews)
            {
                <tr>
                    <td>@review.Reviewer?.UserName</td>
                    <td>@review.Rating</td>
                    <td>@review.ReviewText</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No approved reviews available.</p>
}

<div class="mt-3">
    <a asp-action="ManualReorder" class="btn btn-primary">Back to Manual Reorder</a>
    <a asp-action="AutoReorder" class="btn btn-secondary">Back to Auto Reorder</a>
</div>
