<style>
    /* Ensure qty + cost fields render with black text, black border, white box */
    input[name^="qty_"],
    input[name^="cost_"] {
        background-color: #fff !important; /* white box */
        color: #000 !important; /* black text */
        -webkit-text-fill-color: #000 !important; /* Safari fix */
        border: 1px solid #000 !important; /* black border */
    }

        /* Placeholder color also black */
        input[name^="qty_"]::placeholder,
        input[name^="cost_"]::placeholder {
            color: #000 !important;
            opacity: 1;
        }
</style>

@model IEnumerable<Team24_BevosBooks.Models.Book>

@{
    ViewData["Title"] = "Automatic Reorder";
}

<h2>Automatic Reorder</h2>
<p>These books are below their reorder point. Adjust quantities or costs before placing orders. You can delete rows you don’t need before submitting.</p>

<form asp-action="AutoReorder" method="post" id="autoReorderForm">
    <table class="table table-striped" id="reorderTable">
        <thead class="table-dark">
            <tr>
                <th>Select</th>
                <th>Book Name</th>
                <th>Inventory</th>
                <th>Reorder Point</th>
                <th>Last Supplier Cost</th>
                <th>Avg Profit Margin</th>
                <th>Quantity</th>
                <th>Cost</th>
                <th>Delete Row</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var book in Model)
            {
                var lastCost = ViewBag.LastCosts != null && ViewBag.LastCosts.ContainsKey(book.BookID)
                    ? (decimal)ViewBag.LastCosts[book.BookID]
                    : 0m;

                var profit = ViewBag.AvgMargins != null && ViewBag.AvgMargins.ContainsKey(book.BookID)
                    ? (decimal)ViewBag.AvgMargins[book.BookID]
                    : 0m;

                var marginPercent = book.Price > 0 ? (profit / book.Price) * 100 : 0;
            <tr>
                <td>
                    <input type="checkbox" name="bookIds" value="@book.BookID" checked />
                </td>
                <td>@book.Title</td>
                <td>@book.InventoryQuantity</td>
                <td>@book.ReorderPoint</td>
                <td>@(lastCost > 0 ? lastCost.ToString("C") : "N/A")</td>
                <td>@($"{profit:C} ({marginPercent:F2}%)")</td>   <!-- NEW CELL -->
                <td>
                    <input type="number" name="qty_@book.BookID" value="5" min="0"
                           class="form-control text-dark" style="width:90px;" />
                </td>
                <td>
                    <input type="number" step="0.01" name="cost_@book.BookID"
                           value="@(lastCost > 0 ? lastCost : book.Cost)"
                           min="0.01"
                           class="form-control text-dark" style="width:90px;" />
                </td>
                <td>
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.closest('tr').remove();">
                        Delete
                    </button>
                </td>
            </tr>
        }
            </tbody>
        </table>
    <button type="submit" class="btn btn-success">Place Automatic Orders</button>
</form>
