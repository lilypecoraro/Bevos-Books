<style>
    /* Ensure Check In field renders with black text, black border, white box */
    input[name="arrivedQty"] {
        background-color: #fff !important; /* white background */
        color: #000 !important; /* black text */
        -webkit-text-fill-color: #000 !important; /* Safari fix */
        border: 1px solid #000 !important; /* black border */
    }

        /* Placeholder color also black */
        input[name="arrivedQty"]::placeholder {
            color: #000 !important;
            opacity: 1;
        }
</style>

@model IEnumerable<Team24_BevosBooks.Models.Reorder>

@{
    ViewData["Title"] = "Supplier Reorders";
    // ViewBag.ReceivedTotals is a Dictionary<int,int> (ReorderID -> cumulative received)
    // ViewBag.OutstandingBalances is a Dictionary<int,int> (ReorderID -> outstanding balance)
}

<h2>Supplier Reorders</h2>

<table class="table table-striped">
    <thead class="table-dark">
        <tr>
            <th>Reorder #</th>
            <th>Date</th>
            <th>Status</th>
            <th>Book</th>
            <th>Ordered</th>
            <th>Received</th>
            <th>Outstanding</th>
            <th>Cost</th>
            <th>Check In</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var reorder in Model)
        {
            var received = (ViewBag.ReceivedTotals != null && ViewBag.ReceivedTotals.ContainsKey(reorder.ReorderID))
                ? (int)ViewBag.ReceivedTotals[reorder.ReorderID]
                : 0;

            var outstanding = (ViewBag.OutstandingBalances != null && ViewBag.OutstandingBalances.ContainsKey(reorder.ReorderID))
                ? (int)ViewBag.OutstandingBalances[reorder.ReorderID]
                : reorder.Quantity - received;

            <tr>
                <td>@reorder.ReorderID</td>
                <td>@reorder.Date.ToShortDateString()</td>
                <td>@reorder.ReorderStatus</td>
                <td>@reorder.Book.Title</td>
                <td>@reorder.Quantity</td>
                <td>@received</td>
                <td>@outstanding</td>
                <td>@reorder.Cost.ToString("C")</td>
                <td>
                    @if (reorder.ReorderStatus == "Ordered" && outstanding > 0)
                    {
                        <form asp-action="CheckIn" method="post" class="d-flex">
                            <input type="hidden" name="reorderId" value="@reorder.ReorderID" />
                            <input type="number" name="arrivedQty" min="0" max="@outstanding"
                                   class="form-control text-dark me-2" style="width:90px;" />
                            <button type="submit" class="btn btn-success btn-sm">Check In</button>
                        </form>
                    }
                    else if (outstanding == 0)
                    {
                        <span class="text-success">Received</span>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>
