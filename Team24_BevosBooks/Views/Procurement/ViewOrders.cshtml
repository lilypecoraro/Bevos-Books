@model IEnumerable<Team24_BevosBooks.Models.Order>

@{
    ViewData["Title"] = "Supplier Orders";
}

<h2>Supplier Orders</h2>

<table class="table table-striped align-middle">
    <thead class="table-dark">
        <tr>
            <th>Order #</th>
            <th>Date</th>
            <th>Status</th>
            <th>Admin</th>
            <th>Books</th>
            <th>Total Revenue</th>
            <th>Total Cost</th>
            <th>Profit Margin</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var order in Model)
        {
            var totalRevenue = order.OrderDetails.Sum(d => d.Price * d.Quantity);
            var totalCost = order.OrderDetails.Sum(d => d.Cost * d.Quantity);
            var margin = totalRevenue > 0 ? (totalRevenue - totalCost) / totalRevenue : 0;

            <tr>
                <td>@order.OrderID</td>
                <td>@order.OrderDate.ToString("g")</td>
                <td>@order.OrderStatus</td>
                <td>@order.User?.UserName</td>
                <!-- Force black text on this cell -->
                <td class="book-column">
                    <ul class="list-unstyled">
                        @foreach (var detail in order.OrderDetails)
                        {
                            <li>
                                @detail.Book.Title –
                                Price: @detail.Price.ToString("c"),
                                Cost: @detail.Cost.ToString("c")
                            </li>
                        }
                    </ul>
                </td>
                <td>@totalRevenue.ToString("c")</td>
                <td>@totalCost.ToString("c")</td>
                <td>@($"{margin:P2}")</td>
            </tr>
        }
    </tbody>
    <tfoot>
        @{
            var grandRevenue = Model.Sum(o => o.OrderDetails.Sum(d => d.Price * d.Quantity));
            var grandCost = Model.Sum(o => o.OrderDetails.Sum(d => d.Cost * d.Quantity));
            var grandProfit = grandRevenue - grandCost;
            var grandMargin = grandRevenue > 0 ? grandProfit / grandRevenue : 0;
        }
        <tr class="table-secondary fw-bold">
            <td colspan="5">Total Orders: @Model.Count()</td>
            <td>@grandRevenue.ToString("c")</td>
            <td>@grandCost.ToString("c")</td>
            <td>@($"{grandMargin:P2}")</td>
        </tr>
    </tfoot>
</table>

<style>
    /* ✅ Force black text in the Books column */
    td.book-column, td.book-column li {
        color: black !important;
    }
</style>
