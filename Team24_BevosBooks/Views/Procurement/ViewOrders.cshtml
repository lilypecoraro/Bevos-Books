<style>
    /* Ensure Check In field renders with black text, black border, white box */
    input[name="arrivedQty"] {
        background-color: #fff !important; /* white background */
        color: #000 !important; /* black text */
        -webkit-text-fill-color: #000 !important; /* Safari fix */
        border: 1px solid #000 !important; /* black border */
    }

        /* Placeholder color also black */
        input[name="arrivedQty"]::placeholder {
            color: #000 !important;
            opacity: 1;
        }
</style>



@model IEnumerable<Team24_BevosBooks.Models.Order>

@{
    ViewData["Title"] = "Supplier Orders";
    // ViewBag.ReceivedTotals is a Dictionary<int,int> (OrderDetailID -> cumulative received)
}

<h2>Supplier Orders</h2>

<table class="table table-striped">
    <thead class="table-dark">
        <tr>
            <th>Order #</th>
            <th>Date</th>
            <th>Status</th>
            <th>Book</th>
            <th>Ordered</th>
            <th>Received</th>
            <th>Outstanding</th>
            <th>Cost</th>
            <th>Price</th>
            <th>Check In</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var order in Model)
        {
            foreach (var detail in order.OrderDetails)
            {
                var received = (ViewBag.ReceivedTotals != null && ViewBag.ReceivedTotals.ContainsKey(detail.OrderDetailID))
                    ? (int)ViewBag.ReceivedTotals[detail.OrderDetailID]
                    : 0;

                var outstanding = detail.Quantity - received;

                <tr>
                    <td>@order.OrderID</td>
                    <td>@order.OrderDate.ToShortDateString()</td>
                    <td>@order.OrderStatus</td>
                    <td>@detail.Book.Title</td>
                    <td>@detail.Quantity</td>
                    <td>@received</td>
                    <td>@outstanding</td>
                    <td>@detail.Cost.ToString("C")</td>
                    <td>@detail.Price.ToString("C")</td>
                    <td>
                        @if (order.OrderStatus == "SupplierOrder" && outstanding > 0)
                        {
                            <form asp-action="CheckIn" method="post" class="d-flex">
                                <input type="hidden" name="orderDetailId" value="@detail.OrderDetailID" />
                                <input type="number" name="arrivedQty" min="0" max="@outstanding"
                                       class="form-control text-dark me-2" style="width:90px;" />
                                <button type="submit" class="btn btn-success btn-sm">Check In</button>
                            </form>
                        }
                        else if (outstanding == 0)
                        {
                            <span class="text-success">Received</span>
                        }
                    </td>
                </tr>
            }
        }
    </tbody>
</table>
